# 分布式面试题



### 1. 分布式系统中常用的缓存方案

- 客户端缓存：页面和浏览器缓存。例如：APP缓存、H5缓存、localStorage和 SessionStorage

- [CDN](https://www.zhihu.com/question/36514327)缓存：做**内容存储**：数据的缓存，内容分发；做**负载均衡**

- Nginx缓存：静态资源

- 服务端缓存：本地缓存、外部缓存
- 数据库缓存：持久层缓存（ mybatis、hibernate多级缓存），mysq查询缓存
- 操作系统缓存：Page Cache、 Buffer Cache



### 2. 分布式Session的问题

![img](https://img-blog.csdnimg.cn/28110abd724f4e54b7402b41e0f508e1.png)

① **什么是分布式Session问题**

​		假设我们执行登录操作，服务端将会为每个登录用户都分配一个Session以存储用户的相关信息，以便在后面的请求中，可以够定位到同一个上下文。而当只有一台Tomcat服务器时，并不会出现分布式Session问题，但一台Tomcat服务器的并发量是有限的。因此，在大型项目中一般会配置**多台Tomcat服务器**，并采用Nginx代理分发，而Nginx是采用轮询机制进行分发服务器的，那就会出现一个问题：假设用户A在Tomcat01进行登录操作，但过了一阵后，再次发起请求，而这个请求被分配到了Tomcat02，而由于两台Tomcat服务中的Session没进行同步操作，从而导致用户A需要重新登录。这就是分布式Session问题。


② **解决方案**

**方案一：session复制**

- 优点
    - 无需修改代码，只需要修改Tomcat配置
- 缺点
    - session同步传输占内网带宽
    - 多台Tomcat同步导致性能成指数级下降
    - session会占用内存，无法进行有效扩展



**方案二：前端存储（存入Cookie）**

- 优点
    - 不占用服务端内存
- 缺点
    - 存在安全风险
    - 数据大小受cookie限制
    - 占用外网带宽



**方案三：session粘滞（nian zhi）**

- **粘性session**：apache服务器会把某个用户的请求，交给Tomcat集群中的一个节点，以后此节点就负责保存该用户的session，如果此节点挂掉，那么该用户的session也会消失。
- **非粘性session**：这种方式下，Nginx通过负载均衡器根据节点的情况，把用户的请求进行分发，复制多份session给多个节点，这样，如果节点中其中一个session挂掉的话，其它的还能继续工作，也就是只要有一个节点没有挂掉，该用户的信息就不会消失。


- 优点
    - 无需修改代码
    - 服务端可以水平扩展
- 缺点
    - 增加新机器，会重新hash，导致重新登录
    - 应用重启，需要重新登录



**方案四：IP 绑定策略**

​		使用 Nginx （或其他复杂均衡软硬件）中的 IP 绑定策略，同一个 IP 只能在指定的同一台机器上访问。但这样做便失去了负载均衡的意义，当挂掉一台服务器的时候，就会影响一批用户的使用，所存在的风险很大；

 

**方案五：使用Redis存储Session**

- 优点
    - 安全
    - 便于水平扩展（增加 Redis 服务器）
    - 不仅可以跨服务器 Session 共享，甚至可以跨平台（例如网页端和 APP 端）
- 缺点
    - 增加系统设计的复杂度







